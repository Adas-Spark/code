<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="must-revalidate">
    <meta name="description" content="Ada's Spark Memory Engine - A searchable collection of memories about Ada Rose Swenson">
    <title>Ada's Spark: Hope Against Childhood Cancer</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Vue.js from CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Header Section -->
        <header class="header" role="banner">
            <div class="container">
                <div class="header-content">
                    <div class="logo-section">
                        <div class="logo" aria-label="Ada's Spark Logo">
                            <div class="sun-icon">
                                <i class="fas fa-sun" aria-hidden="true"></i>
                            </div>
                            <div class="logo-text">
                                <span class="logo-main">ada's</span>
                                <span class="logo-sub">SPARK</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content" role="main">
            <div class="container">
                <!-- Title Section -->
                <section class="title-section">
                    <h1 class="main-title">Ada's Spark: Hope Against Childhood Cancer</h1>
                    <div class="description">
                        <p class="body-text">
                            <strong>This memory tool helps you learn about Ada's story and spirit</strong> by searching through 
                            her family's CaringBridge journal entries from her cancer journey. Ask questions about Ada's 
                            Personality, her favorite activities, funny moments, or how she inspired others. The tool uses 
			    AI to find relevant stories and memories to help keep Ada's legacy alive.
			</p>
			<p class="disclaimer-text">
			    <em>Please note: This tool provides stories and memories as recorded by those who knew Ada. While we 
			    strive for accuracy, responses are generated by AI and may not always perfectly capture every 
			    detail. Have questions or feedback? <a href="https://adas-spark.org/contact-us/" target="_blank" rel="noopener">Contact us</a>. 
			    Curious about how we built this? Check out our <a href="https://github.com/Adas-Spark/code" target="_blank" rel="noopener">code on GitHub</a>. 
			    Better documentation is on our todo list!</em>
			</p>                        
                    </div>
                </section>

                <!-- Search Section -->
                <section class="search-section" aria-labelledby="search-heading">
                    <h2 id="search-heading" class="section-title">
                        Example questions (click to populate)<br>
                        or ask your own:
                    </h2>
                    
                    <!-- Example Questions -->
                    <div class="example-questions" role="list">
                        <button 
                            v-for="question in exampleQuestions" 
                            :key="question.id"
                            @click="populateQuestion(question.text)"
                            class="example-question-btn"
                            type="button"
                            role="listitem"
                            :aria-label="'Populate search with: ' + question.text"
                        >
                            <i class="fas fa-minus" aria-hidden="true"></i>
                            {{ question.text }}
                        </button>
                    </div>

                    <!-- Search Input -->
                    <div class="search-container">
                        <div class="search-input-wrapper">
                            <input 
                                v-model="searchQuery"
                                @keyup.enter="performSearch"
                                type="text" 
                                class="search-input"
                                placeholder="Start typing..."
                                aria-label="Search Ada's memories"
                                :disabled="isLoading"
                            >
                            <button 
                                @click="performSearch"
                                class="search-btn"
                                type="button"
                                :disabled="!searchQuery.trim() || isLoading"
                                :aria-label="isLoading ? 'Searching...' : 'Search'"
                            >
                                <i v-if="!isLoading" class="fas fa-arrow-right" aria-hidden="true"></i>
                                <i v-else class="fas fa-spinner fa-spin" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </section>

<!-- Results Section -->
                <section class="results-section" v-if="showResults" aria-labelledby="results-heading">
                    <h2 id="results-heading" class="sr-only">Search Results</h2>
                    
                    <!-- Error State -->
                    <div v-if="error" class="error-message" role="alert">
                        <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                        <p>{{ error }}</p>
                        <button @click="clearError" class="error-close" aria-label="Close error message">
                            <i class="fas fa-times" aria-hidden="true"></i>
                        </button>
                    </div>

                    <!-- No Results -->
                    <div v-else-if="searchResults.length === 0 && !isLoading" class="no-results">
                        <i class="fas fa-search" aria-hidden="true"></i>
                        <p>No results found for "{{ lastSearchQuery }}". Try a different question or rephrase your search.</p>
                    </div>

                    <!-- Results with Photo Sidebar -->
                    <div v-else-if="searchResults.length > 0" class="results-layout">
                        <!-- Main results column -->
                        <div class="results-main">
                            <div class="results-container">
                                <div class="results-header">
                                    <p class="results-meta">
                                        You asked: "<span class="query-text">{{ lastSearchQuery }}</span>" 
                                        <br>The most similar question in the database was 
                                        "<span class="similar-question">{{ searchResults[0]?.question_text }}</span>"
                                    </p>
                                </div>
                                
                                <div class="answer-container">
                                    <h3 class="answer-label">Answer:</h3>
                                    <div class="answer-content">
                                        <p v-if="selectedAnswer" class="answer-text">{{ selectedAnswer.answer_text }}</p>
                                        <div v-if="selectedAnswer" class="answer-meta">
                                            <span class="source-info">
                                                <i class="fas fa-calendar" aria-hidden="true"></i>
                                                {{ formatDate(selectedAnswer.source_date) }}
                                            </span>
                                            <span class="similarity-score">
                                                <i class="fas fa-chart-bar" aria-hidden="true"></i>
                                                {{ Math.round(searchResults[0]?.score * 100) }}% match
                                            </span>
                                            <span v-if="selectedAnswer.related_photos?.length" class="photo-indicator">
                                                <i class="fas fa-camera" aria-hidden="true"></i>
                                                {{ selectedAnswer.related_photos.length }} photos
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Multiple Answers Navigation -->
                                <div v-if="searchResults[0]?.answers?.length > 1" class="answers-navigation">
                                    <p class="answers-count">{{ searchResults[0].answers.length }} answers available</p>
                                    <div class="answers-pagination">
                                        <button 
                                            v-for="(answer, index) in searchResults[0].answers" 
                                            :key="answer.answer_id"
                                            @click="selectAnswer(answer, index)"
                                            :class="['answer-nav-btn', { 'active': selectedAnswerIndex === index }]"
                                            :aria-label="'View answer ' + (index + 1)"
                                        >
                                            {{ index + 1 }}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Photo Sidebar -->
                        <aside class="photo-sidebar" v-if="selectedAnswer?.related_photos?.length > 0" role="complementary" aria-labelledby="photos-heading">
                            <h4 id="photos-heading" class="sidebar-title">Related Photos</h4>
                            
                            <div class="photo-gallery" role="list">
                                <button 
                                    v-for="photo in selectedAnswer.related_photos" 
                                    :key="photo.photo_id"
                                    class="gallery-photo-item"
                                    role="listitem"
                                    :data-photo-id="photo.photo_id"
                                    @click="openPhotoModal(photo)"
                                    :aria-label="`View photo: ${photo.caption_moment || photo.caption}`"
                                    type="button"
                                >
                                    <div class="photo-container">
                                        <!-- Loading state -->
                                        <div v-if="photoLoadStates[photo.photo_id] === 'loading'" class="photo-skeleton">
                                            <div class="skeleton-shimmer"></div>
                                        </div>
                                        
                                        <!-- Error state -->
                                        <div v-else-if="photoLoadStates[photo.photo_id] === 'error'" class="photo-error">
                                            <i class="fas fa-image"></i>
                                            <span>Unable to load</span>
                                        </div>
                                        
                                        <!-- Photo -->
                                        <img 
                                            v-show="photoLoadStates[photo.photo_id] === 'loaded'"
                                            :src="photo.thumbnail_url" 
                                            :alt="photo.caption_moment || photo.caption"
                                            class="gallery-thumbnail"
                                            loading="lazy"
                                            @load="onPhotoLoad(photo.photo_id)"
                                            @error="onPhotoError(photo.photo_id)"
                                        >
                                    </div>
                                    
                                    <div class="photo-info">
                                        <div class="photo-caption">{{ photo.caption_moment || photo.caption }}</div>
                                        <div class="photo-meta">
                                            <span class="relevance-indicator" :class="getRelevanceLabel(photo.relevance_score).toLowerCase().replace(' ', '-')">
                                                <i class="fas fa-link"></i> {{ getRelevanceLabel(photo.relevance_score) }}
                                            </span>
                                        </div>
                                    </div>
                                </button>
                            </div>
                        </aside>
                    </div>
                </section>
            </div>
        </main>

        </main>
        
        <!-- Photo Modal -->
        <div 
            v-if="selectedPhoto" 
            class="photo-modal" 
            role="dialog" 
            aria-modal="true"
            aria-labelledby="modal-title"
            @click="closePhotoModal"
        >
            <div class="modal-content" @click.stop>
                <button 
                    @click="closePhotoModal" 
                    class="modal-close"
                    aria-label="Close photo"
                    type="button"
                >
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="modal-image-container">
                    <img 
                        :src="selectedPhoto.modal_url || selectedPhoto.thumbnail_url" 
                        :alt="selectedPhoto.caption_moment || selectedPhoto.caption" 
                        class="modal-image"
                    >
                </div>
                
                <div class="modal-info">
                    <h3 id="modal-title" class="modal-caption">{{ selectedPhoto.caption_moment || selectedPhoto.caption }}</h3>
                    <p v-if="selectedPhoto.caption_full" class="modal-description">{{ selectedPhoto.caption_full }}</p>
                    <p class="modal-date">{{ formatDate(selectedPhoto.source_date) }}</p>
                    <span class="relevance-indicator" :class="getRelevanceLabel(selectedPhoto.relevance_score).toLowerCase().replace(' ', '-')">
                        {{ getRelevanceLabel(selectedPhoto.relevance_score) }}
                    </span>
                </div>
            </div>
        </div>
    </div>

        <!-- Footer -->
        <footer class="footer" role="contentinfo">
            <div class="container">
                <p class="footer-text">
                    © 2024 Ada's Spark. Created with love in memory of Ada Rose Swenson.
                </p>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="app.js"></script>
    <script>
    // Detect if page is loaded in an iframe and hide banners
    if (window !== window.top) {
        document.body.classList.add('in-iframe');
    }
    </script>
</body>
</html>
